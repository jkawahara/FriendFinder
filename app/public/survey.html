<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <title>Friend Finder Survey</title>
</head>
<body>
  <!-- Jumbotron header -->
  <div class="container">
    <div class="jumbotron text-center mt-4 py-1">
      <h1 class="display-6">Personality Test</h1>
      <p class="lead">Complete the questions below to build your personality profile. Once your profile is completed, potential matches will be presented.</p>
    </div>
  </div>

  <!-- Personality test inputs (name, photo) and selects (1 thru 5 responses for 10 questions)  -->
  <div class="container">
    <form>
      <div class="form-group">
        <label for="inputName"><h5>Your Name</h5></label>
        <input type="text" class="form-control" id="name" required>
        <label for="inputPhoto"><h5>Link to your Photo</h5></label>
        <input type="text" class="form-control" id="photo" required>
      </div>
      <h5>
        <strong>Question 1</strong>
        <p>You are motivated to get out of bed before sunrise.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q1" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 2</strong>
        <p>You think formal training is important.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q2" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 3</strong>
        <p>You appreciate bizare or quirky talents over professional skills.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q3" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 4</strong>
        <p>You believe it's important to have role models.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q4" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 5</strong>
        <p>You prefer to listen instead of talking when in social situations.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q5" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 6</strong>
        <p>You routinely go out at night.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q6" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 7</strong>
        <p>You enjoy maintaining a comfortable home environment.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q7" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 8</strong>
        <p>You are chased by others more often than being the one chasing others.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q8" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 9</strong>
        <p>You take the path least traveled.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q9" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h5>
        <strong>Question 10</strong>
        <p>You drink a lot.</p>
      </h5>
      <div class="form-group">
        <select class="chosen-select" id="q10" required>
          <option value></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">Submit</button>
    </form>
  </div>

  <!-- Footer with API links -->
  <footer class="footer">
    <div class="container mt-4">
      <p><a href="/api/friends">API Friends Link</a></p>
    </div>
  </footer>
  
  <!-- Modal popsup when match is made, after survey is completed-->
  <div class="modal fade" id="match-result" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Most Compatible Pet Friend</h4>
        </div>
        <div class="modal-body">
          <h3 id="match-name"></h2>
          <img id="match-img" src="" alt="Match Image">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      </div>
    </div>

  <!-- Custom JavaScript -->
  <script type="text/javascript">
    // Listen for Form submit button
    $("#submit").on("click", function(event) {
      // Prevent default refresh of page
      event.preventDefault();
      // Verify if any fields are incomplete
      function validateForm() {
        var isValid = true;
        $(".form-control").each(function() {
          if ($(this).val() === "") {
            isValid = false;
          }
        });
        $(".chosen-select").each(function() {
          if ($(this).val() === "") {
            isValid = false;
          }
        });
        return isValid;
      }
      // If all fields completed, assign survey responses to new friend profile object with same properties (name, photo, scores[0...9] as friendsData object
      if (validateForm()) {
        var newFriend = {
          name: $("#name").val().trim(),
          photo: $("#photo").val().trim(),
          scores: [
            $("#q1").val(),
            $("#q2").val(),
            $("#q3").val(),
            $("#q4").val(),
            $("#q5").val(),
            $("#q6").val(),
            $("#q7").val(),
            $("#q8").val(),
            $("#q9").val(),
            $("#q10").val()
          ]
        };
        // Clear the form
        $("#name").val("");
        $("#photo").val("");
        $("#q1").val("");
        $("#q2").val("");
        $("#q3").val("");
        $("#q4").val("");
        $("#q5").val("");
        $("#q6").val("");
        $("#q7").val("");
        $("#q8").val("");
        $("#q9").val("");
        $("#q10").val("");

        // Post request to server with newFriend data object
        $.post("/api/friends", newFriend, function(data) {
          
          // Update modal with name and photo link of best match
          $("#match-name").text(data.name);
          $("#match-img").attr("src", data.photo);

          // Toggle modal
          $("#match-result").modal("toggle");
        });
      } else {
        alert("Please complete all fields before submitting.");
      }
    });
  </script>
</body>
</html>